<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ChE120 Design</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --primary:#00A8B5;
  --secondary:#162B45;
  --border:#d1d9e0;
  --bg:#f8f9fa;
}
html,body{
  margin:0;
  height:100vh;
  width:100vw;
  overflow:hidden;
  font-family:Segoe UI,Tahoma,sans-serif;
  background:var(--bg);
}
header{
  height:50px;
  background:var(--secondary);
  color:#fff;
  display:flex;
  align-items:center;
  padding:0 20px;
}
header span{color:var(--primary);}
.app{
  display:flex;
  height:calc(100vh - 50px);
}
.sidebar{
  width:380px;
  background:#fff;
  border-right:1px solid var(--border);
  padding:15px;
  display:flex;
  flex-direction:column;
}
.inputs-container{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.input-group{
  display:flex;
  flex-direction:column;
}
.input-group label{
  font-size:12.05px;
  font-weight:700;
  color:#555;
  text-transform:uppercase;
  margin-bottom:2px;
}
.input-group input{
  width:100%;
  padding:10px;
  border:1px solid #ddd;
  border-radius:4px;
  font-size:14px;
  box-sizing:border-box;
}
button{
  width:100%;
  padding:14px;
  background:var(--primary);
  border:none;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  margin-top:6px;
  box-sizing:border-box;
}
.result-box{
  margin-top:6px;
  background:var(--secondary);
  color:#fff;
  padding:12px;
  border-radius:6px;
  text-align:center;
  flex-shrink:0;
}
.result-box div{
  font-size:10px;
  opacity:0.8;
  margin-bottom:3px;
}
.result-box span{
  font-size:1.5rem;
  color:var(--primary);
  font-weight:800;
}
.viewport{
  flex-grow:1;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
  background-color:#f0f2f5;
}
.sim-square{
  width:550px;
  height:550px;
  background:#fff;
  border:1px solid var(--border);
  position:relative;
  box-shadow:0 5px 15px rgba(0,0,0,0.05);
  flex-shrink:0;
}

.sim-legend {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255,255,255,0.8);
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 12px;
  color: #162B45;
  font-weight: 600;
}
.sim-legend div {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-bottom: 4px;
}
.sim-legend div:last-child {
  margin-bottom: 0;
}
.pipe-color {
  display: inline-block;
  width: 12px;
  height: 12px;
  background-color: #162B45;
  border-radius: 2px;
}
.ins-color {
  display: inline-block;
  width: 12px;
  height: 12px;
  background-color: #00A8B5;
  border-radius: 2px;
}
.graph-sidebar{
  width:350px;
  background:#fff;
  border-left:1px solid var(--border);
  display:flex;
  flex-direction:column;
  padding:10px;
  gap:10px;
  position:relative;
}
.chart-card{
  flex:1;
  border:1px solid #edf0f2;
  border-radius:8px;
  padding:10px;
  display:flex;
  flex-direction:column;
  min-height:0;
}
.chart-card canvas{
  flex-grow:1;
  width:100% !important;
  height:100% !important;
}
.sim-square {
    width: 100%;
    max-width: 550px;
    aspect-ratio: 1/1;
    background: white;
    border: 1px solid var(--border);
    position: relative;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);

    background-image: 
        linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);
    background-size: 40px 40px; 
}
</style>
</head>
<footer>
  <div class="footer-strip">
    <p>© 2025 Che120 Design Project</p>
  </div>
</footer>
<style>
.footer-strip {
  width: 100%;
  height: 20px;            
  background: var(--secondary); 
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  position: fixed;             
  bottom: 0;
  left: 0;
  z-index: 1000;
  font-weight: 600;
  font-size: 14px;
}
.footer-strip p {
  margin: 0;
}
</style>
<body>
    
<header>
  <h1><span>ChE120 </span>INSULATION THICKNESS DESIGN </h1>
</header>

<div class="app">
  <div class="sidebar">
    <div class="inputs-container">
      <div class="input-group"><label>Inner Radius (mm)</label><input type="number" id="in1" value="50"></div>
      <div class="input-group"><label>Wall Thickness (mm)</label><input type="number" id="in2" value="10"></div>
      <div class="input-group"><label>Pipe Length (m)</label><input type="number" id="in3" value="1"></div>
      <div class="input-group"><label>Fluid Temp (°C)</label><input type="number" id="in4" value="100"></div>
      <div class="input-group"><label>Ambient Temp (°C)</label><input type="number" id="in5" value="20"></div>
      <div class="input-group"><label>Max Heat Loss (W)</label><input type="number" id="in6" value="60"></div>
      <div class="input-group"><label>Thermal Cond. (W/m·K)</label><input type="number" id="in7" value="0.035"></div>
      <button onclick="updateSimulation()">UPDATE SIMULATION</button>
      <div class="result-box">
        <div>COMPUTED INSULATION THICKNESS</div>
        <span id="resVal">0.00 mm</span>
      </div>
    </div>
  </div>
  <div class="viewport">
    <div class="sim-square" id="three-container">
  <div class="sim-legend">
    <div><span class="pipe-color"></span> Pipe</div>
    <div><span class="ins-color"></span> Insulation</div>
  </div>
</div>
  </div>
  <div class="graph-sidebar">
    <div class="chart-card"><canvas id="c1"></canvas></div>
    <div class="chart-card"><canvas id="c2"></canvas></div>
    <div class="chart-card"><canvas id="c3"></canvas></div>
  </div>
</div>

<script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<script>
let scene, camera, renderer, pipe, insulation;
const container=document.getElementById('three-container');
scene=new THREE.Scene();
camera=new THREE.PerspectiveCamera(40,container.clientWidth/container.clientHeight,0.1,1000);
camera.position.set(1.5,0.8,1.9);
camera.lookAt(0,0,0);

renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(container.clientWidth,container.clientHeight);
container.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.6));
const dirLight=new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(5,10,5);
scene.add(dirLight);

const controls=new THREE.OrbitControls(camera,renderer.domElement);
controls.enableDamping=true;
controls.dampingFactor=0.05;
controls.minDistance=0.5;
controls.maxDistance=10;

const pipeGroup=new THREE.Group();
scene.add(pipeGroup);
const radialSegments=64;

function createPipeMesh(){
  const r_i=parseFloat(in1.value)/1000;
  const t_pipe=parseFloat(in2.value)/1000;
  const L=parseFloat(in3.value);
  const Tf=parseFloat(in4.value);
  const Ta=parseFloat(in5.value);
  const q=parseFloat(in6.value);
  const k=parseFloat(in7.value);

  if(pipe) pipeGroup.remove(pipe);
  const pipeGeom=new THREE.CylinderGeometry(r_i+t_pipe,r_i+t_pipe,L,radialSegments,1,true);
  const pipeMat=new THREE.MeshLambertMaterial({color:0x162B45,side:THREE.DoubleSide});
  pipe=new THREE.Mesh(pipeGeom,pipeMat);
  pipe.rotation.z=Math.PI/2;
  pipeGroup.add(pipe);

  const t_ins=computeThickness(r_i,t_pipe,Tf,Ta,q,k)/1000;
  if(insulation) pipeGroup.remove(insulation);
  const insGeom=new THREE.CylinderGeometry(r_i+t_pipe+t_ins,r_i+t_pipe+t_ins,L,radialSegments,1,true);
  const insMat=new THREE.MeshLambertMaterial({color:0x00A8B5,transparent:true,opacity:0.6,side:THREE.DoubleSide});
  insulation=new THREE.Mesh(insGeom,insMat);
  insulation.rotation.z=Math.PI/2;
  pipeGroup.add(insulation);

  resVal.textContent=(t_ins*1000).toFixed(2)+' mm';
}

function computeThickness(r_i,t_pipe,Tf,Ta,q,k){
  const r1=r_i+t_pipe;
  const r2=r1*Math.exp((2*Math.PI*k*(Tf-Ta))/q);
  return (r2-r1)*1000; // mm
}

let ch1,ch2,ch3;
function initCharts(){
  const cfg=(title,x,y)=>({
    type:'line',
    data:{labels:[],datasets:[{data:[],borderColor:'#00A8B5',fill:false,tension:0.3}]},
    options:{
      maintainAspectRatio:false,
      plugins:{legend:{display:false},title:{display:true,text:title,color:'#162B45'}},
      scales:{x:{title:{display:true,text:x}},y:{title:{display:true,text:y}}}
    }
  });
  ch1=new Chart(c1,cfg("Thickness vs Length","Length (m)","mm"));
  ch2=new Chart(c2,cfg("Thickness vs Heat Loss","W","mm"));
  ch3=new Chart(c3,cfg("Thickness vs Thermal Cond.","k","mm"));
}

function updateCharts(){
  const r_i=parseFloat(in1.value)/1000;
  const t_pipe=parseFloat(in2.value)/1000;
  const Tf=parseFloat(in4.value);
  const Ta=parseFloat(in5.value);
  const q=parseFloat(in6.value);
  const k=parseFloat(in7.value);
  const L=parseFloat(in3.value);

  const lengths=[L*0.2,L*0.4,L*0.6,L*0.8,L];
  ch1.data.labels=lengths;
  ch1.data.datasets[0].data=lengths.map(l=>computeThickness(r_i,t_pipe,Tf,Ta,q,k));
  ch1.update();

  const qVals=[q*0.5,q,q*1.5];
  ch2.data.labels=qVals.map(v=>v.toFixed(0));
  ch2.data.datasets[0].data=qVals.map(v=>computeThickness(r_i,t_pipe,Tf,Ta,v,k));
  ch2.update();

  const kVals=[k*0.5,k,k*1.5];
  ch3.data.labels=kVals.map(v=>v.toFixed(3));
  ch3.data.datasets[0].data=kVals.map(v=>computeThickness(r_i,t_pipe,Tf,Ta,q,v));
  ch3.update();
}

function updateSimulation(){
  createPipeMesh();
  updateCharts();
}

function animate(){
  requestAnimationFrame(animate);
  pipeGroup.rotation.x+=0.01;
  controls.update();
  renderer.render(scene,camera);
}
animate();

window.onload=()=>{
  initCharts();
  updateSimulation();
};
window.onresize=()=>renderer.setSize(container.clientWidth,container.clientHeight);
</script>
</body>

</html>
